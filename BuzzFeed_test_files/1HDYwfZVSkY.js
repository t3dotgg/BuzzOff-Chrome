/*!CK:605362545!*//*1411957120,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["bfN2+"]); }

__d("legacy:nearby-controller",["NearbyController"],function(a,b,c,d){a.NearbyController=b('NearbyController');},3);
__d("CurationOneClickButton",["Banzai","CSS","cx","DOM","EntstreamFeedObject","EntstreamFeedObjectFollowup","Event","SaveState","SaveStateHandler","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q="saved_for_later:click",r="remove",s="_vu",t="_54nc",u="_vv";function v(w,x,y,z,aa,ba,ca){"use strict";this.$CurationOneClickButton0=false;this.$CurationOneClickButton1=w;this.$CurationOneClickButton2=z;var da=null;ba.forEachItem(function(ea){if(ea.getValue()==r)da=j.find(ea.getRoot(),'a.'+t);});p([m.listen(x,'click',this.setSaving.bind(this,aa)),m.listen(x,'error',this.setUnsaved.bind(this,aa)),m.listen(y,'click',this.logFlyoutClick.bind(this,ca)),m.listen(da,'error',this.setSaved.bind(this,aa)),ba.subscribe('itemclick',function(ea,fa){var ga=fa.item.getValue();if(ga==r)this.setUnsaving(aa);}.bind(this))]);o.listen([aa],function(ea){switch(ea){case n.SAVING:h.addClass(w,s);h.addClass(ba.getRoot(),u);this.$CurationOneClickButton0=true;break;case n.SAVED:h.addClass(w,s);h.removeClass(w,u);h.removeClass(ba.getRoot(),u);this.$CurationOneClickButton0=false;break;case n.UNSAVING:h.removeClass(w,s);h.addClass(w,u);x.setAttribute('rel','');this.$CurationOneClickButton0=true;break;case n.UNSAVED:h.removeClass(w,s);h.removeClass(w,u);h.removeClass(ba.getRoot(),u);x.setAttribute('rel','async-post');this.$CurationOneClickButton0=false;break;}}.bind(this));}v.prototype.setSaving=function(w){"use strict";if(!this.$CurationOneClickButton0){o.saving([w]);var x=k.getRoot(this.$CurationOneClickButton1);x&&l.addFollowup(x,this.$CurationOneClickButton2,"_521o");}};v.prototype.setUnsaving=function(w){"use strict";if(!this.$CurationOneClickButton0){o.unsaving([w]);var x=k.getRoot(this.$CurationOneClickButton1),y=l.getFollowup(x);y&&l.removeFollowup(x);}};v.prototype.setSaved=function(w){"use strict";o.saved([w]);};v.prototype.setUnsaved=function(w){"use strict";o.unsaved([w]);};v.prototype.logFlyoutClick=function(w){"use strict";g.post(q,{og_object_id:w.og_object_id,collection_id:w.collection_id,surface:w.surface,mechanism:w.mechanism});};e.exports=v;},null);